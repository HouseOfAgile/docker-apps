#!/usr/bin/env bash
# generated by docker-apps: build all generate dockerfiles
list_ops=()
[ "$DEBUG" ] && set -x
for variant in '' {{ docker_bases|join(' ') }};
do
  this_image_name={{ docker_image_name }}"$([ ! -z "$variant" ] && echo ":"$variant || echo '')"
  echo -e "Building $this_image_name..."
  docker build -t $this_image_name . \
  -f Dockerfile$([ ! -z "$variant" ] && echo "."$variant || echo '') >output$([ ! -z "$variant" ] && echo "."$variant || echo '') 2>&1
  if [ $? == 0 ]; then
    docker_network="{{ (' --network='+settings['default_docker_network']+' ') if settings['default_docker_network'] else '' }}"
    list_ops=( "  Run it with: docker run ${docker_network}-d -P $this_image_name" "${list_ops[@]}")
    list_ops=( "Image $this_image_name successfully created" "${list_ops[@]}")
  else
    list_ops=( "Image $this_image_name was not created, check output (cat output$([ ! -z "$variant" ] && echo "."$variant || echo '')) " "${list_ops[@]}")
  fi
done

printf '%s\n' "${list_ops[@]}"
