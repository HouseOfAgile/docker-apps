# generated by docker-apps
version: '3.7'
{% set ns = namespace(there_is_volume=false) %}

## Main service
## {{ service_main }}

services:
{% if compose is defined %}
{{ compose['main']['name'] | indent(2,True) }}:
    hostname: ${APP_NAME}_{{env}}
    volumes:
{% for volume in compose_env.volumes -%}
    {%- if not ns.there_is_volume -%}
    {%- set ns.there_is_volume = volume | regex_match("^[a-zA-Z0-9]+") -%}
    {%- endif -%}
    {{ ('- ' + volume) | indent(4,True) }}
{% endfor %}
{% if compose_env.environment %}
    environment:
    {%- for env in compose_env.environment %}
{{ ('- ' + env) | indent(4,True) }}
    {%- endfor %}
{% endif %}
    ports:
{%- for port in compose_env.ports %}
{{ ('- ' + port) | indent(4,True) }}
{%- endfor %}    

    {%- if ns.there_is_volume %}
volumes:
        {%- for volume in compose_env.volumes %}
            {%- if volume | regex_match("^[a-zA-Z0-9]+") %}
{{ (volume|regex_split(':')+':') | indent(2,True) }}
            {%- endif %}
        {%- endfor %}
    {% endif %}
{% endif %}
